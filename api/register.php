<?php require 'config.php'; header('Content-Type: application/json'); $data=json_decode(file_get_contents("php://input")); if(!isset($data->email)){exit();} do { $id=mt_rand(100000,999999); $stmt=$conn->prepare("SELECT id FROM users WHERE id=?"); $stmt->execute([$id]); } while($stmt->rowCount()>0); $hash=password_hash($data->password,PASSWORD_DEFAULT); try{ $conn->prepare("INSERT INTO users (id,email,password_hash,full_name,role,is_verified,institute,target_year) VALUES (?,?,?,?,?,1,?,?)")->execute([$id,$data->email,$hash,$data->name,$data->role,isset($data->institute)?$data->institute:'',isset($data->targetYear)?$data->targetYear:2025]); $u=$conn->query("SELECT * FROM users WHERE id=$id")->fetch(PDO::FETCH_ASSOC); echo json_encode(["message"=>"Success","user"=>$u]); }catch(Exception $e){ http_response_code(500); echo json_encode(["error"=>$e->getMessage()]); }