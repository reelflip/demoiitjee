<?php require 'config.php'; header('Content-Type: application/json'); $data = json_decode(file_get_contents("php://input")); try { $conn->beginTransaction(); if($data->accept) { $conn->prepare("UPDATE users SET parent_id=? WHERE id=?")->execute([$data->parent_id, $data->student_id]); $conn->prepare("UPDATE users SET student_id=? WHERE id=?")->execute([$data->student_id, $data->parent_id]); } $conn->prepare("UPDATE users SET pending_request_json=NULL WHERE id=?")->execute([$data->student_id]); $conn->commit(); echo json_encode(["message"=>"Processed"]); } catch(Exception $e){ $conn->rollBack(); echo json_encode(["error"=>$e->getMessage()]); }