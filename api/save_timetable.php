<?php require 'config.php'; header('Content-Type: application/json'); $data = json_decode(file_get_contents("php://input")); if (!isset($data->user_id) || !isset($data->config)) { http_response_code(400); echo json_encode(["message" => "Missing data"]); exit(); } try { $stmt = $conn->prepare("INSERT INTO timetable_settings (user_id, config_json, generated_slots_json) VALUES (:uid, :config, :slots) ON DUPLICATE KEY UPDATE config_json=:config, generated_slots_json=:slots"); $stmt->execute([':uid' => $data->user_id, ':config' => json_encode($data->config), ':slots' => json_encode($data->slots)]); echo json_encode(["message" => "Timetable saved"]); } catch(PDOException $e) { http_response_code(500); echo json_encode(["error" => "Save failed", "message" => $e->getMessage()]); }